NOTE TO SELF: REWRITE THIS THING